(()=>{var e={637:()=>{const e=["gif","jpg","jpeg","png"],t=document.querySelector("#upload-file"),r=document.querySelector(".img-upload__preview img"),n=document.querySelectorAll(".effects__preview");t.addEventListener("change",(()=>{const o=t.files[0],c=o.name.toLowerCase();if(e.some((e=>c.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{r.src=e.result,n.forEach((t=>{t.style.backgroundImage=`url(${e.result})`}))})),e.readAsDataURL(o)}}))}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var c=t[n]={exports:{}};return e[n](c,c.exports,r),c.exports}(()=>{"use strict";const e=e=>"Escape"===e.key||"Esc"===e.key,t=document.querySelector(".img-upload__preview img"),n=document.querySelector(".img-upload__effects"),o=document.querySelector(".img-upload__effect-level"),c=document.querySelector(".effect-level__value"),s=document.querySelector(".effect-level__slider");o.classList.add("visually-hidden");let l="";const i={none:()=>(o.classList.add("visually-hidden"),"none"),chrome:()=>(o.classList.remove("visually-hidden"),`grayscale(${.01*parseInt(c,10)})`),sepia:()=>(o.classList.remove("visually-hidden"),`sepia(${.01*parseInt(c,10)})`),marvin:()=>(o.classList.remove("visually-hidden"),`invert(${Math.floor(c,10)}%)`),phobos:()=>(o.classList.remove("visually-hidden"),`blur(${.03*parseInt(c,10)}%)`),heat:()=>(o.classList.remove("visually-hidden"),`brightness(${.03*parseInt(c,10)})`)};n.addEventListener("click",(e=>{if(e.target.classList.contains("effects__preview")){""!==l&&t.classList.remove(l),s.noUiSlider.set(100);let r=e.target.classList[1];l=r,t.classList.add(r),t.getElementsByClassName.filter=i[r.replace("effects__preview--","")]()}})),noUiSlider.create(s,{range:{min:0,max:100},start:100,step:.1,connect:"lower"}),s.noUiSlider.on("change",(()=>{c.value=s.noUiSlider.get(),t.style.filter=i[l.replace("effects__preview--","")]()}));const a=document.querySelector("body"),d=a.querySelector("#success").content.querySelector(".success"),u=document.createDocumentFragment(),m=a.querySelector("#error").content.querySelector(".error"),v=document.createDocumentFragment(),y=t=>{e(t)&&_()},p=(e,t,r)=>{document.querySelector(t).contains(e.target)||_(r)},_=e=>{e.remove(),document.removeEventListener("keydown",y),document.removeEventListener("click",p.bind)},g=(t,r)=>{const n=m.cloneNode(!0);n.querySelector(".error__title").textContent=t,n.querySelector(".error__button").textContent=r;const o=n.querySelector(".error__button");document.addEventListener("keydown",(t=>{e(t)&&_(n)})),document.addEventListener("click",(e=>{p(e,".error__inner",n)})),o.addEventListener("click",(()=>{_(n)})),v.appendChild(n),a.appendChild(v)},h={GET:"https://23.javascript.pages.academy/kekstagram/data",POST:"https://23.javascript.pages.academy/kekstagram "},L=(e,t,r,n)=>{fetch(h[r],{method:r,body:n}).then((e=>e.json())).then((t=>e(t))).catch((()=>t()))},S=document.querySelector("body"),f=document.querySelector(".img-upload__form"),q=f.querySelector("#upload-file"),E=f.querySelector(".img-upload__overlay"),k=f.querySelector("#upload-cancel"),C=t=>{e(t)&&w()},w=()=>{S.classList.remove("modal-open"),E.classList.add("hidden"),q.value="",document.removeEventListener("keydown",C)};q.addEventListener("change",(()=>{I(),S.classList.add("modal-open"),E.classList.remove("hidden"),document.addEventListener("keydown",C)})),k.addEventListener("click",(()=>{w()}));const b=f.querySelector(".scale__control--bigger"),x=f.querySelector(".scale__control--smaller"),D=f.querySelector(".scale__control--value"),T=f.querySelector(".img-upload__preview img"),V=f.querySelector(".text__hashtags"),$=f.querySelector(".text__description"),I=()=>{D.value="100%",T.style.transform="scale(1.00)",T.style.filter="",V.value="",$.value="",l&&T.classList.remove(l),o.classList.add("visually-hidden")},F=e=>{D.value=e+"%",e/=100,T.style.transform="scale("+e+")"};x.addEventListener("click",(()=>{let e=parseInt(D.value,10)-25;e<=25&&(e=25),F(e)})),b.addEventListener("click",(()=>{let e=parseInt(D.value,10)+25;e>=100&&(e=100),F(e)}));const j=()=>{(()=>{const t=d.cloneNode(!0),r=t.querySelector(".success__button");document.addEventListener("keydown",(r=>{e(r)&&_(t)})),document.addEventListener("click",(e=>{p(e,".success__inner",t)})),r.addEventListener("click",(()=>{_(t)})),u.appendChild(t),a.appendChild(u)})(),w(),f.reset()},M=()=>{g("Ошибка загрузки файла","Загрузить другой файл")};f.addEventListener("submit",(e=>{e.preventDefault(),L(j,M,"POST",new FormData(e.target))}));const N=document.querySelector(".text__hashtags"),U=document.querySelector(".text__description");N.addEventListener("input",(()=>{N.setCustomValidity("");let e=N.value.toLowerCase().trim();if(!e)return;let t=e.split(/\s+/);0!==t.length&&(t.some((e=>"#"!==e[0]))&&N.setCustomValidity("Хэштег начинается с символа #"),t.some((e=>"#"===e))&&N.setCustomValidity("Хеш-тег не может состоять только из одной решётки"),t.some((e=>e.indexOf("#",1)>=1))&&N.setCustomValidity("хэш-теги разделяются пробелами"),t.some(((e,t,r)=>r.indexOf(e,t+1)>=t+1))&&N.setCustomValidity("один и тот же хэш-тег не может быть использован дважды"),t.some((e=>e.length>20))&&N.setCustomValidity("максимальная длина одного хэш-тега 20 символов, включая решётку"),t.length>5&&N.setCustomValidity("нельзя указать больше пяти хэш-тегов"),N.reportValidity())}));const O=t=>{e(t)&&(t.preventDefault(),t.stopPropagation())};N.addEventListener("keydown",O),U.addEventListener("keydown",O);const A=document.querySelector("body"),P=document.querySelector(".big-picture"),G=P.querySelector(".social__comment-count"),H=P.querySelector(".comments-loader"),R=P.querySelector(".big-picture__cancel"),B=P.querySelector(".social__comments"),W=document.querySelector("#comment").content.querySelector(".social__comment"),z=document.createDocumentFragment();let J=[],K=5;const Q=t=>{e(t)&&(t.preventDefault(),X())},X=()=>{P.classList.add("hidden"),A.classList.remove("modal-open"),R.removeEventListener("click",X),B.innerHTML="",document.removeEventListener("keydown",Q),K=5,J=[]},Y=e=>{K=e.length<5?e.length:K,J=e.slice(0,K),B.innerHTML="",G.textContent=`${J.length} из ${e.length} комментариев`,J.forEach((e=>z.appendChild((e=>{const t=W.cloneNode(!0);return t.querySelector(".social__picture").src=e.avatar,t.querySelector(".social__picture").alt=e.name,t.querySelector(".social__text").textContent=e.message,t})(e)))),B.appendChild(z),e.length>5&&J.length<e.length?(H.classList.remove("hidden"),H.addEventListener("click",(()=>{Y(e)}),{once:!0})):H.classList.add("hidden"),K+=5},Z=document.querySelector("#picture").content.querySelector(".picture"),ee=document.createDocumentFragment(),te=document.querySelector(".pictures"),re=e=>{e.forEach((e=>{const t=Z.cloneNode(!0);t.querySelector(".picture__img").src=e.url,t.querySelector(".picture__likes").textContent=e.likes,t.querySelector(".picture__comments").textContent=e.comments.length,t.addEventListener("click",(t=>{t.preventDefault(),(e=>{K=5,J=[],P.classList.remove("hidden"),A.classList.add("modal-open"),document.addEventListener("keydown",Q),P.querySelector(".big-picture__img img").src=e.url,P.querySelector(".likes-count").textContent=e.likes,P.querySelector(".social__caption").textContent=e.description,Y(e.comments.slice()),R.addEventListener("click",X)})(e)})),ee.appendChild(t)})),te.appendChild(ee)},ne=document.querySelector(".img-filters");let oe=[];const ce={"filter-default":()=>re(oe.slice(0,25)),"filter-random":()=>re((e=>{let t,r;for(let n=e.length-1;n>0;n--)t=Math.floor(Math.random()*(n+1)),r=e[t],e[t]=e[n],e[n]=r;return e})(oe.slice(0,10))),"filter-discussed":()=>{re(oe.slice().sort(((e,t)=>t.comments.length-e.comments.length)))}};L((e=>{ne.classList.remove("img-filters--inactive"),oe=e.slice(),re(oe.slice(0,25))}),(()=>{g("Ошибка загрузки, попробуйте еще раз","Закрыть")}),"GET");const se=(e=>{let t=null;return(...e)=>{t&&window.clearTimeout(t),t=window.setTimeout((()=>{(e=>{e.target.classList.contains("img-filters__button")&&(document.querySelector(".img-filters__button--active").classList.remove("img-filters__button--active"),(()=>{const e=document.querySelectorAll(".picture");e&&e.forEach((e=>{e.remove()}))})(),e.target.classList.add("img-filters__button--active"),ce[e.target.id]())})(...e)}),500)}})();ne.addEventListener("click",se),r(637)})()})();
//# sourceMappingURL=main.bundle.js.map